#!/usr/bin/env node

const PackageDetector = require("../lib/utils/package-detector");
const TypeScriptLibraryBuilder = require("../lib/builders/typescript-library");
const TypeScriptAppBuilder = require("../lib/builders/typescript-app");
const PythonLibraryBuilder = require("../lib/builders/python-library");
const PythonAppBuilder = require("../lib/builders/python-app");
const ConfigPackageBuilder = require("../lib/builders/config-package");

const createLogger = require("../../alphab-logging-ui/src/index").createLogger;
const logger = createLogger("alphab-dev");

async function main() {
  try {
    const detector = new PackageDetector();
    const packageType = detector.getPackageType();
    const packageName = detector.getPackageName();

    logger.log(`ðŸ”¥ Starting dev mode for ${packageName} (${packageType})`);

    let builder;
    switch (packageType) {
      case "typescript-library":
        builder = new TypeScriptLibraryBuilder(detector);
        break;
      case "typescript-app":
        builder = new TypeScriptAppBuilder(detector);
        break;
      case "python-library":
        builder = new PythonLibraryBuilder(detector);
        break;
      case "python-app":
        builder = new PythonAppBuilder(detector);
        break;
      case "config-package":
        builder = new ConfigPackageBuilder(detector);
        break;
      default:
        throw new Error(`Unknown package type: ${packageType}`);
    }

    await builder.dev();
  } catch (error) {
    logger.error(`ðŸ’¥ Dev mode failed: ${error.message}`);
    process.exit(1);
  }
}

main();
